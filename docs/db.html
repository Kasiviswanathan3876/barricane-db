<!DOCTYPE html>  <html> <head>   <title>db.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="barricane-db.html">                 barricane-db.js               </a>                                           <a class="source" href="bdb-disk-manager.html">                 bdb-disk-manager.js               </a>                                           <a class="source" href="db.html">                 db.js               </a>                                           <a class="source" href="disk-io.html">                 disk-io.js               </a>                                           <a class="source" href="old-barricane-db.html">                 old-barricane-db.js               </a>                                           <a class="source" href="serialisation.html">                 serialisation.js               </a>                                           <a class="source" href="demo.html">                 demo.js               </a>                                           <a class="source" href="hello_world.html">                 hello_world.js               </a>                                           <a class="source" href="model.html">                 model.js               </a>                                           <a class="source" href="old-disk-manager.html">                 old-disk-manager.js               </a>                                           <a class="source" href="old-serialisation.html">                 old-serialisation.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               db.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Copyright (c) 2010 Barricane Technology Ltd., All Rights Reserved.
Released under the MIT open source licence.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This module contains the database code.
It specifically eschews serialisation and io concerns.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;uuid&#39;</span><span class="p">)</span><span class="nx">l</span>
  <span class="p">,</span> <span class="nx">dio</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./disk-io&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The DB constructor represents the database. In almost all circumstances only
one database will exist per process. More can be used, if needed, but the
application will become more complex, as it cannot use
<code>process.db</code> in constructors.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">DB</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><code>magic</code> is a string which must not normally occur in your application's
property names. Double underscore is the default.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">this</span><span class="p">.</span><span class="nx">magic</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">magic</span> <span class="o">||</span> <span class="s2">&quot;__&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>uuid</code> is the function used to generate unique IDs for each
managed object. It is overridable for testing purposes, where the IDs
need to be deterministic.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">this</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">||</span> <span class="nx">uuid</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The <code>io</code> manager is responsible for IO. By default BarricaneDB
uses simple disk-nased persistence. The <code>ioManager</code> is
separated so that it can be optionally replaced with ReplicationIO at
some point in the future.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">this</span><span class="p">.</span><span class="nx">io</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">io</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">dio</span><span class="p">.</span><span class="nx">DiskIO</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><code>instances</code> contains all of the <em>managed</em> objects, indexed
by uuid.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">this</span><span class="p">.</span><span class="nx">instances</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>stores</code> contains all of the <em>managed</em> objects' data, indexed
by uuid. The data is separate as the properties in the instances have
custom getters/setters, via <code><strong>defineSetter</strong></code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">this</span><span class="p">.</span><span class="nx">stores</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Export the symbols.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">DB</span> <span class="o">=</span> <span class="nx">DB</span><span class="p">;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 